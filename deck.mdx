import { CodeSurferLayout } from "code-surfer";
import "prismjs/components/prism-java";
import "prismjs/components/prism-scala";

import { Mermaid } from "./mermaid";
import { Graphviz } from "./Graphviz";

import { githubFull } from "code-surfer/themes";
import myTheme from './myTheme';

export const themes = [githubFull, myTheme]

# :evergreen_tree: :evergreen_tree: :evergreen_tree:

# Future-proofing Scala through TASTY

Guillaume Martres - EPFL

# :evergreen_tree: :evergreen_tree: :evergreen_tree:

---

# Compiler pipeline

<Graphviz dot={`
digraph {
bgcolor=transparent;
rankdir=LR;
node [fontsize="28.0", fontname="Source Sans Pro", shape="box"];
me [label="Middle-End"];
src [label="Hello.scala", shape="note"];
tst [label="Hello.tasty", shape="note"];
dst [label="Hello.class", shape="note"];
{ rank=same src Parser }
{ rank=same Pickler tst }
{ rank=same Backend dst }
src -> Parser -> Typer -> Pickler -> me -> Backend -> dst;
Pickler -> tst;
}
`} options={{width: null, height: null}}/>

---

# Untyped Tree

<Mermaid params={{ theme: "forest" }} chart={`
graph TB;
app(Apply) --> sel(Select);
app --> lit("Literal");
lit --> 5("5");
sel --> id("Ident(''obj'')");
sel --> fun("''meth''");
`} />

---

<CodeSurferLayout>

```scala
obj.meth(5)
```

```scala 1[1:3],3,6[1:16]
obj.meth(5)

// Parser output:
Apply(
  Select(
    Ident("obj"),
    "meth"
  ),
  Literal(5)
)
```

```scala 1[4],5,8[1:3]
obj.meth(5)

// Parser output:
Apply(
  Select(
    Ident("obj"),
    "meth"
  ),
  Literal(5)
)
```

```scala 1[5:8],7
obj.meth(5)

// Parser output:
Apply(
  Select(
    Ident("obj"),
    "meth"
  ),
  Literal(5)
)
```

```scala 1[9,11],4,10
obj.meth(5)

// Parser output:
Apply(
  Select(
    Ident("obj"),
    "meth"
  ),
  Literal(5)
)
```

```scala 1[10],9
obj.meth(5)

// Parser output:
Apply(
  Select(
    Ident("obj"),
    "meth"
  ),
  Literal(5)
)
```
</CodeSurferLayout>
